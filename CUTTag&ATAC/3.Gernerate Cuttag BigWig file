# Spike-in normalized Cut&Tag pipeline
BLACKLIST="/path/to/hg38-blacklist.v2.bed"
SAMPLE="sample_id"

# NOR1: Number of reads aligned concordantly exactly 1 time in spike-in alignment
  sf=$(echo "scale=6; 100000 / NOR1" | bc)

# Generate spike-in normalized coverage
  bamCoverage \
    -b ${SAMPLE}_clean.bam \
    -o ${SAMPLE}_Normalized.bw \
    --centerReads --smoothLength 400 --extendReads 200 -bs 20 \
    --ignoreDuplicates --minMappingQuality 30 \
    -bl ${BLACKLIST} \
    --numberOfProcessors 8 \
    --scaleFactor ${sf}
